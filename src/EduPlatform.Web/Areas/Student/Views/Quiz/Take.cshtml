@model EduPlatform.Web.ViewModels.Student.TakeQuizViewModel
@{
    ViewData["Title"] = "حل الاختبار";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between mb-3">
        <h3>@Model.Title</h3>
        <h4 class="text-danger">الوقت المتبقي: <span id="timer">@Model.TimeLimit:00</span></h4>
    </div>

    <form asp-action="Submit" method="post">
        <input type="hidden" name="QuizId" value="@Model.QuizId" />

        @foreach (var question in Model.Questions)
        {
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">@question.QuestionText</h5>

                    @if (question.Type == EduPlatform.Core.Enums.QuestionType.MultipleChoice)
                    {
                        var options = System.Text.Json.JsonSerializer.Deserialize<List<string>>(question.OptionsJson);
                        for (int i = 0; i < options.Count; i++)
                        {
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="Answers[@question.Id]" value="@i" id="opt_@question.Id@i">
                                <label class="form-check-label" for="opt_@question.Id@i">@options[i]</label>
                            </div>
                        }
                    }
                    else // True/False
                    {
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="Answers[@question.Id]" value="True" id="t_@question.Id">
                            <label class="form-check-label" for="t_@question.Id">صح</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="Answers[@question.Id]" value="False" id="f_@question.Id">
                            <label class="form-check-label" for="f_@question.Id">خطأ</label>
                        </div>
                    }
                </div>
            </div>
        }

        <button type="submit" class="btn btn-success btn-lg w-100">إنهاء الاختبار</button>
    </form>
</div>

@section Scripts {
    <script>
        // Timer بسيط
        var duration = @Model.TimeLimit * 60;
        var display = document.getElementById('timer');

        var timer = setInterval(function () {
            minutes = parseInt(duration / 60, 10);
            seconds = parseInt(duration % 60, 10);

            display.textContent = minutes + ":" + (seconds < 10 ? "0" : "") + seconds;

            if (--duration < 0) {
                clearInterval(timer);
                alert("انتهى الوقت!");
                document.forms[0].submit(); // إرسال تلقائي
            }
        }, 1000);
    </script>
}