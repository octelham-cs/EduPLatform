@model List<EduPlatform.Web.ViewModels.Ticket.TicketListItemViewModel>
@{
    ViewData["Title"] = "تذاكر الدعم الفني";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid fade-in">
    <div class="row mb-4">
        <div class="col">
            <h1 class="h3 mb-3">
                <i class="fas fa-headset text-primary ms-2"></i>
                تذاكر الدعم الفني
            </h1>
            <p class="text-muted">
                هنا يمكنك متابعة جميع تذاكر الدعم الفني الخاصة بك
            </p>
        </div>
        <div class="col-auto">
            <!-- زر التذكرة الجديدة - بالطريقة الجديدة -->
            <a href="@Url.Action("Create", "Ticket", new { area = "Instructor" })" class="btn btn-primary">
                <i class="fas fa-plus ms-2"></i>
                تذكرة جديدة
            </a>
        </div>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show mb-4" role="alert">
            <i class="fas fa-check-circle ms-2"></i>
            @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (!Model.Any())
    {
        <div class="text-center py-5">
            <div class="mb-4">
                <i class="fas fa-ticket-alt fa-5x text-muted opacity-25"></i>
            </div>
            <h4 class="text-muted mb-3">لا توجد تذاكر حتى الآن</h4>
            <p class="text-muted mb-4">
                يمكنك إنشاء تذكرة دعم فني جديدة وسيقوم فريق الدعم بالرد عليك في أقرب وقت
            </p>
            <!-- زر إنشاء تذكرة جديدة - بالطريقة الجديدة -->
            <a href="@Url.Action("Create", "Ticket", new { area = "Instructor" })" class="btn btn-primary btn-lg">
                <i class="fas fa-plus ms-2"></i>
                إنشاء تذكرة جديدة
            </a>
        </div>
    }
    else
    {
        <div class="card shadow-sm border-0">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>#</th>
                                <th>العنوان</th>
                                <th>الحالة</th>
                                <th>الأولوية</th>
                                <th>تاريخ الإنشاء</th>
                                <th>الردود</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var (ticket, index) in Model.Select((t, i) => (t, i + 1)))
                            {
                                <tr>
                                    <td class="text-muted">@index</td>
                                    <td>
                                        <div class="fw-semibold">@ticket.Title</div>
                                    </td>
                                    <td>
                                        <span class="badge bg-@ticket.StatusColor px-3 py-2">
                                            @ticket.Status
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-@ticket.PriorityColor px-3 py-2">
                                            @ticket.Priority
                                        </span>
                                    </td>
                                    <td>
                                        <small class="text-muted">@ticket.CreatedAtFormatted</small>
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary bg-opacity-10 text-secondary px-3 py-2">
                                            <i class="fas fa-comment ms-1"></i>
                                            @ticket.RepliesCount
                                        </span>
                                    </td>
                                    <td>
                                        <!-- زر التفاصيل - بالطريقة الجديدة -->
                                        <a href="@Url.Action("Details", "Ticket", new { area = "", id = ticket.Id })"
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-eye ms-1"></i>
                                            التفاصيل
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            @if (TempData["Success"] != null)
            {
                    <text>
                    Swal.fire({
                        icon: 'success',
                        title: 'تم',
                        text: '@TempData["Success"]',
                        timer: 3000,
                        showConfirmButton: false
                    });
                    </text>
            }
        });
    </script>
}